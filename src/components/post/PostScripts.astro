<script>
    const copiedPath = "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"
    const idlePath = "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"

    const codeTitlesElements = document.querySelectorAll("*[id^=code-title]")
    codeTitlesElements.forEach(element => {
        let active = false;
        const buttonElement = element.children[0]
        buttonElement.addEventListener('click', () => {
            navigator.clipboard?.writeText(element.nextElementSibling.textContent)
                .then(() => {
                    if (active) return;
                    active = true;

                    const svgElement = buttonElement.children[0]
                    const svgPathElement = svgElement.children[0]
                    const toggleClasses = (svgPath: string) => {
                        svgPathElement.setAttribute("d", svgPath)
                        svgElement.classList.toggle('text-green-500')
                        svgElement.classList.toggle('force-opacity')
                        svgElement.classList.toggle('stroke-2')
                        svgElement.classList.toggle('scale-125')
                    }

                    toggleClasses(copiedPath)

                    const timeoutId = setTimeout(() => {
                        toggleClasses(idlePath)
                        clearTimeout(timeoutId)
                        active = false;
                    }, 1500)
                })
        })
    })
</script>

<script>
    const postNavigationList = document.getElementById('post-navigation-list')
    const postNavigationLinks = postNavigationList.getElementsByTagName('li')

    const headingsElements = document.getElementsByTagName('article')[0].querySelectorAll('h2, h3, h4, h5, h6')
    const headingsElementsHeights = []
    headingsElements.forEach((heading) => {
        headingsElementsHeights.push((heading as HTMLElement).offsetTop)
    })

    const classNames = ['text-ether-secondary1', 'font-bold', 'border-ether-secondary1']

    document.addEventListener('scroll', () => {
        const scrollValue = window.scrollY
        let set = false
        headingsElementsHeights.forEach((value, index) => {
            // 96px -> header height, 3px -> offset
            if (!set && value - scrollValue > 96 + 6) {
                set = true
                postNavigationLinks[index - 1]?.classList.add(...classNames)
            }
            else {
                postNavigationLinks[index - 1]?.classList.remove(...classNames)
            }
        })
    })
</script>

<script>
    const goUpAndCommentsContainer = document.getElementById("go-up-and-comments-container")
    document.addEventListener("scroll", () => {
        const show = document.scrollingElement.scrollTop > 64
        goUpAndCommentsContainer.classList[show ? "remove" : "add"]("hidden")
        goUpAndCommentsContainer.classList[!show ? "remove" : "add"]("flex")
    })
    document.getElementById("go-up-button").addEventListener("click", () => {
        document.scrollingElement.scrollTo({ top: 0, behavior: "smooth" })
    })
    document.getElementById("go-comments-button").addEventListener("click", () => {
        document.getElementById("comments-container").scrollIntoView({ behavior: "smooth" })
    })
</script>